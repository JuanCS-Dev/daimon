<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        
        /* Cyberpunk Theme */
        :root {
            --cyber-pink: #ff2a6d;
            --cyber-cyan: #05d9e8;
            --cyber-purple: #9d4edd;
            --cyber-yellow: #f9c80e;
            --cyber-dark: #0a0a0f;
            --cyber-darker: #05050a;
        }
        
        body {
            background: linear-gradient(135deg, var(--cyber-darker) 0%, var(--cyber-dark) 50%, #0f0f1a 100%);
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
        }
        
        /* Glowing effects */
        .glow-cyan { box-shadow: 0 0 20px rgba(5, 217, 232, 0.3), inset 0 0 20px rgba(5, 217, 232, 0.1); }
        .glow-pink { box-shadow: 0 0 20px rgba(255, 42, 109, 0.3), inset 0 0 20px rgba(255, 42, 109, 0.1); }
        .glow-purple { box-shadow: 0 0 20px rgba(157, 78, 221, 0.3), inset 0 0 20px rgba(157, 78, 221, 0.1); }
        
        .text-glow-cyan { text-shadow: 0 0 10px rgba(5, 217, 232, 0.8); }
        .text-glow-pink { text-shadow: 0 0 10px rgba(255, 42, 109, 0.8); }
        
        /* Scanlines overlay */
        .scanlines::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.1) 2px,
                rgba(0, 0, 0, 0.1) 4px
            );
            pointer-events: none;
            z-index: 1000;
        }
        
        /* Neon borders */
        .border-neon-cyan { border-color: var(--cyber-cyan); }
        .border-neon-pink { border-color: var(--cyber-pink); }
        
        /* Tab styling */
        .tab-active {
            background: linear-gradient(180deg, rgba(5, 217, 232, 0.2) 0%, transparent 100%);
            border-bottom: 2px solid var(--cyber-cyan);
        }
        
        /* Card styling */
        .cyber-card {
            background: linear-gradient(145deg, rgba(10, 10, 15, 0.9) 0%, rgba(15, 15, 25, 0.9) 100%);
            border: 1px solid rgba(5, 217, 232, 0.3);
            backdrop-filter: blur(10px);
        }
        
        /* Progress bars */
        .progress-cyber {
            background: linear-gradient(90deg, var(--cyber-cyan), var(--cyber-purple));
        }
        
        /* Pulse animation */
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--cyber-darker); }
        ::-webkit-scrollbar-thumb { background: var(--cyber-cyan); border-radius: 3px; }
    </style>
</head>
<body class="text-gray-100 min-h-screen scanlines">
    <div x-data="dashboard()" x-init="init()" x-cloak class="container mx-auto px-4 py-6 max-w-7xl relative z-10">

        <!-- Header -->
        <header class="mb-6 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-cyan-500 to-purple-600 flex items-center justify-center text-2xl font-bold glow-cyan">
                    D
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-glow-cyan" style="color: var(--cyber-cyan)">DAIMON</h1>
                    <p class="text-xs text-gray-500 uppercase tracking-widest">Exocortex v3.0 // C√©lula H√≠brida</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-xs text-gray-500">
                    <span class="text-cyan-400">SYNC:</span> <span x-text="lastUpdate"></span>
                </div>
                <div class="flex gap-1">
                    <span class="w-2 h-2 rounded-full bg-green-500 pulse-glow"></span>
                    <span class="w-2 h-2 rounded-full bg-cyan-500 pulse-glow" style="animation-delay: 0.3s"></span>
                    <span class="w-2 h-2 rounded-full bg-purple-500 pulse-glow" style="animation-delay: 0.6s"></span>
                </div>
            </div>
        </header>

        <!-- Status Bar -->
        <section class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6">
            <template x-for="(status, service) in services" :key="service">
                <div class="cyber-card rounded-lg p-3 glow-cyan">
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-400 uppercase tracking-wider" x-text="service"></span>
                        <span class="w-2 h-2 rounded-full"
                              :class="{
                                  'bg-green-500 pulse-glow': status === 'healthy' || status === 'active',
                                  'bg-red-500': status === 'offline' || status === 'inactive',
                                  'bg-yellow-500': status === 'unhealthy'
                              }">
                        </span>
                    </div>
                    <div class="text-sm font-bold mt-1" 
                         :class="{'text-green-400': status === 'healthy', 'text-red-400': status === 'offline'}"
                         x-text="status">
                    </div>
                </div>
            </template>
        </section>

        <!-- Tabs Navigation -->
        <nav class="flex border-b border-gray-800 mb-6">
            <button @click="activeTab = 'overview'" 
                    :class="activeTab === 'overview' ? 'tab-active' : ''"
                    class="px-6 py-3 text-sm font-medium hover:text-cyan-400 transition">
                ‚ö° Overview
            </button>
            <button @click="activeTab = 'learning'" 
                    :class="activeTab === 'learning' ? 'tab-active' : ''"
                    class="px-6 py-3 text-sm font-medium hover:text-cyan-400 transition">
                üß† Learning
            </button>
            <button @click="activeTab = 'patterns'" 
                    :class="activeTab === 'patterns' ? 'tab-active' : ''"
                    class="px-6 py-3 text-sm font-medium hover:text-cyan-400 transition">
                üìä Patterns
            </button>
            <button @click="activeTab = 'collectors'" 
                    :class="activeTab === 'collectors' ? 'tab-active' : ''"
                    class="px-6 py-3 text-sm font-medium hover:text-cyan-400 transition">
                üì° Collectors
            </button>
            <button @click="activeTab = 'config'" 
                    :class="activeTab === 'config' ? 'tab-active' : ''"
                    class="px-6 py-3 text-sm font-medium hover:text-cyan-400 transition">
                ‚öôÔ∏è Config
            </button>
            <button @click="activeTab = 'corpus'" 
                    :class="activeTab === 'corpus' ? 'tab-active' : ''"
                    class="px-6 py-3 text-sm font-medium hover:text-cyan-400 transition">
                üìö Corpus
            </button>
        </nav>

        <!-- Tab: Overview -->
        <div x-show="activeTab === 'overview'" x-transition>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Stats Cards -->
                <div class="cyber-card rounded-lg p-6 glow-cyan">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üìà System Stats</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Reflex√µes</span>
                            <span class="text-2xl font-bold text-cyan-400" x-text="preferences.total_reflections || 0"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Updates</span>
                            <span class="text-2xl font-bold text-purple-400" x-text="preferences.total_updates || 0"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Sinais Detectados</span>
                            <span class="text-2xl font-bold text-pink-400" x-text="getTotalSignals()"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Taxa Aprova√ß√£o</span>
                            <span class="text-2xl font-bold text-green-400" x-text="getAvgApproval() + '%'"></span>
                        </div>
                    </div>
                </div>

                <!-- Approval Rate Chart -->
                <div class="cyber-card rounded-lg p-6 glow-purple lg:col-span-2">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üìä Taxa de Aprova√ß√£o por Categoria</h3>
                    <div class="h-64">
                        <canvas id="approvalChart"></canvas>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="cyber-card rounded-lg p-6 glow-pink lg:col-span-3">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs text-gray-400 uppercase tracking-wider">‚ö° Quick Actions</h3>
                        <div class="flex gap-3">
                            <button @click="triggerReflection()"
                                    :disabled="reflecting"
                                    class="bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-cyan-500 hover:to-purple-500 disabled:from-gray-600 disabled:to-gray-700 px-6 py-2 rounded-lg font-medium transition glow-cyan">
                                <span x-show="!reflecting">üîÆ Refletir</span>
                                <span x-show="reflecting">‚è≥ Processando...</span>
                            </button>
                            <button @click="loadAllData()"
                                    class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg text-sm transition border border-gray-700">
                                üîÑ Atualizar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Mini preference preview -->
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                        <template x-for="(data, category) in preferences.current_preferences || {}" :key="category">
                            <div class="bg-gray-900/50 rounded-lg p-3 border border-gray-800">
                                <div class="text-xs text-gray-400 capitalize truncate" x-text="category.replace('_', ' ')"></div>
                                <div class="flex items-center gap-2 mt-2">
                                    <div class="flex-1 bg-gray-800 rounded-full h-1.5">
                                        <div class="h-1.5 rounded-full progress-cyber transition-all"
                                             :style="'width: ' + (data.approval_rate * 100) + '%'">
                                        </div>
                                    </div>
                                    <span class="text-xs font-bold" 
                                          :class="data.approval_rate > 0.7 ? 'text-green-400' : 'text-yellow-400'"
                                          x-text="Math.round(data.approval_rate * 100) + '%'">
                                    </span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Learning -->
        <div x-show="activeTab === 'learning'" x-transition>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                <!-- Preferences Detail -->
                <div class="cyber-card rounded-lg p-6 glow-cyan">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üß† Prefer√™ncias Aprendidas</h3>
                    
                    <template x-if="Object.keys(preferences.current_preferences || {}).length > 0">
                        <div class="space-y-4">
                            <template x-for="(data, category) in preferences.current_preferences" :key="category">
                                <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium capitalize" x-text="category.replace('_', ' ')"></span>
                                        <span class="text-xs px-2 py-1 rounded"
                                              :class="{
                                                  'bg-green-500/20 text-green-400': data.trend === 'positive',
                                                  'bg-red-500/20 text-red-400': data.trend === 'negative',
                                                  'bg-yellow-500/20 text-yellow-400': data.trend === 'neutral' || data.trend === 'insufficient_data'
                                              }"
                                              x-text="data.trend">
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex-1 bg-gray-800 rounded-full h-3">
                                            <div class="h-3 rounded-full progress-cyber transition-all"
                                                 :style="'width: ' + (data.approval_rate * 100) + '%'">
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold min-w-16 text-right"
                                              :class="data.approval_rate > 0.7 ? 'text-green-400' : data.approval_rate > 0.4 ? 'text-yellow-400' : 'text-red-400'"
                                              x-text="Math.round(data.approval_rate * 100) + '%'">
                                        </span>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-500 mt-2">
                                        <span>‚úÖ <span x-text="data.approvals || 0"></span> aprova√ß√µes</span>
                                        <span>‚ùå <span x-text="data.rejections || 0"></span> rejei√ß√µes</span>
                                        <span>üìä <span x-text="data.total_signals || 0"></span> total</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                    
                    <template x-if="Object.keys(preferences.current_preferences || {}).length === 0">
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üîÆ</div>
                            <p>Nenhuma prefer√™ncia detectada ainda.</p>
                            <p class="text-xs mt-1">Clique em "Refletir" para analisar sess√µes.</p>
                        </div>
                    </template>
                </div>

                <!-- Signals Chart -->
                <div class="cyber-card rounded-lg p-6 glow-purple">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üìà Sinais por Categoria</h3>
                    <div class="h-80">
                        <canvas id="signalsChart"></canvas>
                    </div>
                </div>

                <!-- Thresholds -->
                <div class="cyber-card rounded-lg p-6 glow-pink lg:col-span-2">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">‚öñÔ∏è Thresholds de Reflex√£o</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center border border-gray-800">
                            <div class="text-3xl font-bold text-red-400" x-text="preferences.thresholds?.rejection || 5"></div>
                            <div class="text-xs text-gray-400 mt-1">Rejei√ß√µes p/ trigger</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center border border-gray-800">
                            <div class="text-3xl font-bold text-green-400" x-text="preferences.thresholds?.approval || 10"></div>
                            <div class="text-xs text-gray-400 mt-1">Aprova√ß√µes p/ trigger</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center border border-gray-800">
                            <div class="text-3xl font-bold text-cyan-400" x-text="preferences.config?.interval_minutes || 30"></div>
                            <div class="text-xs text-gray-400 mt-1">Intervalo (min)</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center border border-gray-800">
                            <div class="text-3xl font-bold text-purple-400" x-text="preferences.config?.scan_hours || 48"></div>
                            <div class="text-xs text-gray-400 mt-1">Scan (horas)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Patterns -->
        <div x-show="activeTab === 'patterns'" x-transition>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                <!-- Pattern Types -->
                <div class="cyber-card rounded-lg p-6 glow-cyan">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üîç Tipos de Padr√µes</h3>
                    <div class="space-y-4">
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-cyan-500/30">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">‚è∞</span>
                                <div>
                                    <div class="font-medium text-cyan-400">Temporal</div>
                                    <div class="text-xs text-gray-500">A√ß√µes em hor√°rios espec√≠ficos</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-400">Ex: "git commit √†s 17:00"</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-purple-500/30">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">üîó</span>
                                <div>
                                    <div class="font-medium text-purple-400">Sequential</div>
                                    <div class="text-xs text-gray-500">Sequ√™ncias de comandos</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-400">Ex: "git status ‚Üí add ‚Üí commit"</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-pink-500/30">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">üéØ</span>
                                <div>
                                    <div class="font-medium text-pink-400">Contextual</div>
                                    <div class="text-xs text-gray-500">A√ß√µes em contextos espec√≠ficos</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-400">Ex: "debug mode in VS Code"</div>
                        </div>
                    </div>
                </div>

                <!-- Emergence Status -->
                <div class="cyber-card rounded-lg p-6 glow-purple">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üåü Emergence Engine</h3>
                    <div class="space-y-4">
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Mode</span>
                                <span class="px-2 py-1 rounded bg-cyan-500/20 text-cyan-400 text-sm">SUBTLE</span>
                            </div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Cooldown</span>
                                <span class="text-lg font-bold text-purple-400">10 min</span>
                            </div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Min Patterns</span>
                                <span class="text-lg font-bold text-pink-400">1</span>
                            </div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Confidence Threshold</span>
                                <span class="text-lg font-bold text-green-400">0.5</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Collectors -->
        <div x-show="activeTab === 'collectors'" x-transition>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="(data, name) in collectors" :key="name">
                    <div class="cyber-card rounded-lg p-6" 
                         :class="data.process_running ? 'glow-cyan' : 'border-red-500/30'">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg capitalize" x-text="name.replace('_', ' ')"></h3>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="w-2 h-2 rounded-full"
                                          :class="data.process_running ? 'bg-green-500 pulse-glow' : 'bg-red-500'">
                                    </span>
                                    <span class="text-xs"
                                          :class="data.process_running ? 'text-green-400' : 'text-red-400'"
                                          x-text="data.process_running ? 'RUNNING' : 'STOPPED'">
                                    </span>
                                </div>
                            </div>
                            <div class="text-3xl">
                                <template x-if="name === 'shell_watcher'">üêö</template>
                                <template x-if="name === 'claude_watcher'">ü§ñ</template>
                                <template x-if="name === 'window_watcher'">ü™ü</template>
                                <template x-if="name === 'input_watcher'">‚å®Ô∏è</template>
                                <template x-if="name === 'afk_watcher'">üí§</template>
                                <template x-if="name === 'browser_watcher'">üåê</template>
                            </div>
                        </div>
                        
                        <template x-if="data.socket_exists !== undefined">
                            <div class="text-xs text-gray-500 mb-4">
                                Socket: <span :class="data.socket_exists ? 'text-green-400' : 'text-red-400'" 
                                              x-text="data.socket_exists ? 'OK' : 'N/A'"></span>
                            </div>
                        </template>
                        
                        <div class="flex gap-2">
                            <button @click="startCollector(name)"
                                    :disabled="data.process_running"
                                    class="flex-1 bg-green-600 hover:bg-green-500 disabled:bg-gray-700 disabled:text-gray-500 py-2 rounded text-sm font-medium transition">
                                ‚ñ∂ Start
                            </button>
                            <button @click="stopCollector(name)"
                                    :disabled="!data.process_running"
                                    class="flex-1 bg-red-600 hover:bg-red-500 disabled:bg-gray-700 disabled:text-gray-500 py-2 rounded text-sm font-medium transition">
                                ‚¨õ Stop
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Tab: Config -->
        <div x-show="activeTab === 'config'" x-transition>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                <!-- CLAUDE.md Editor -->
                <div class="cyber-card rounded-lg p-6 glow-cyan lg:col-span-2">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs text-gray-400 uppercase tracking-wider">üìù ~/.claude/CLAUDE.md</h3>
                        <div class="flex gap-2">
                            <button @click="loadClaudeMd()"
                                    class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm transition">
                                üîÑ Reload
                            </button>
                            <button @click="saveClaudeMd()"
                                    :disabled="!claudeMdChanged"
                                    class="bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-cyan-500 hover:to-purple-500 disabled:from-gray-600 disabled:to-gray-700 px-4 py-2 rounded text-sm font-medium transition">
                                üíæ Save
                            </button>
                        </div>
                    </div>
                    
                    <textarea x-model="claudeMd"
                              @input="claudeMdChanged = true"
                              class="w-full h-80 bg-gray-900 border border-gray-700 rounded-lg p-4 font-mono text-sm resize-y focus:outline-none focus:border-cyan-500 transition"
                              placeholder="Loading...">
                    </textarea>
                    
                    <div class="flex justify-between items-center mt-2 text-xs">
                        <span :class="claudeMdExists ? 'text-green-400' : 'text-yellow-400'"
                              x-text="claudeMdExists ? '‚úì File exists' : '‚ö† Will be created'"></span>
                        <span x-show="claudeMdChanged" class="text-yellow-400">‚óè Unsaved changes</span>
                    </div>
                </div>

                <!-- Backups -->
                <div class="cyber-card rounded-lg p-6 glow-purple lg:col-span-2">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üíæ Backups</h3>
                    
                    <template x-if="backups.length > 0">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                            <template x-for="backup in backups" :key="backup.path">
                                <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-800 flex justify-between items-center">
                                    <div>
                                        <div class="font-mono text-sm text-cyan-400" x-text="backup.filename"></div>
                                        <div class="text-xs text-gray-500" x-text="formatBytes(backup.size_bytes)"></div>
                                    </div>
                                    <button @click="restoreBackup(backup.path)"
                                            class="bg-yellow-600 hover:bg-yellow-500 px-3 py-1 rounded text-xs font-medium transition">
                                        ‚Ü© Restore
                                    </button>
                                </div>
                            </template>
                        </div>
                    </template>
                    
                    <template x-if="backups.length === 0">
                        <p class="text-gray-500 text-center py-4">No backups available.</p>
                    </template>
                </div>
            </div>
        </div>

        <!-- Tab: Corpus -->
        <div x-show="activeTab === 'corpus'" x-transition>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Corpus Stats -->
                <div class="cyber-card rounded-lg p-6 glow-cyan">
                    <h3 class="text-xs text-gray-400 uppercase tracking-wider mb-4">üìä Corpus Stats</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-cyan-400" x-text="corpusStats.total_texts || 0"></div>
                            <div class="text-xs text-gray-400">Textos</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-purple-400" x-text="corpusStats.total_authors || 0"></div>
                            <div class="text-xs text-gray-400">Autores</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-pink-400" x-text="corpusStats.total_themes || 0"></div>
                            <div class="text-xs text-gray-400">Temas</div>
                        </div>
                        <div class="bg-gray-900/50 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold text-yellow-400" x-text="Object.keys(corpusStats.by_category || {}).length"></div>
                            <div class="text-xs text-gray-400">Categorias</div>
                        </div>
                    </div>
                    
                    <!-- Search -->
                    <div class="mt-4 pt-4 border-t border-gray-800">
                        <div class="flex gap-2">
                            <input x-model="corpusSearch" @keyup.enter="searchCorpus()"
                                   placeholder="Buscar..."
                                   class="flex-1 bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm focus:border-cyan-500 focus:outline-none">
                            <button @click="searchCorpus()"
                                    class="bg-cyan-600 hover:bg-cyan-500 px-4 py-2 rounded text-sm transition">
                                üîç
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Corpus Tree -->
                <div class="cyber-card rounded-lg p-6 glow-purple lg:col-span-2 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs text-gray-400 uppercase tracking-wider">üìÅ √Årvore de Categorias</h3>
                        <button @click="showCorpusForm = !showCorpusForm"
                                class="bg-green-600 hover:bg-green-500 px-3 py-1 rounded text-xs transition">
                            + Add
                        </button>
                    </div>
                    
                    <template x-for="(catData, catName) in corpusTree.tree" :key="catName">
                        <div class="mb-3">
                            <div class="flex items-center text-yellow-400 font-medium">
                                <span class="mr-2">üìÅ</span>
                                <span x-text="catName"></span>
                            </div>
                            <template x-for="text in (catData._texts || [])" :key="text.id">
                                <div @click="loadFullText(text.id)"
                                     class="ml-6 py-2 px-3 cursor-pointer hover:bg-cyan-500/10 rounded transition">
                                    <div class="text-sm text-gray-300" x-text="text.title"></div>
                                    <div class="text-xs text-gray-500" x-text="text.author"></div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 text-center text-gray-600 text-xs">
            <p>DAIMON v3.0 // C√©lula H√≠brida Human-AI // Port 8003</p>
            <p class="mt-1 text-gray-700">Powered by NOESIS Consciousness Engine</p>
        </footer>

    </div>

    <script>
        function dashboard() {
            return {
                // State
                activeTab: 'overview',
                services: {},
                preferences: {},
                collectors: {},
                claudeMd: '',
                claudeMdExists: false,
                claudeMdChanged: false,
                backups: [],
                reflecting: false,
                lastUpdate: '',
                
                // Corpus
                corpusStats: {},
                corpusTree: { tree: {}, categories: [], authors: [], themes: [] },
                showCorpusForm: false,
                corpusSearch: '',
                corpusResults: [],
                fullText: null,

                // Charts
                approvalChart: null,
                signalsChart: null,

                // Init
                async init() {
                    await this.loadAllData();
                    this.initCharts();
                    setInterval(() => this.loadAllData(), 15000);
                },

                async loadAllData() {
                    try {
                        const [statusRes, prefsRes, collectorsRes, backupsRes, corpusStatsRes, corpusTreeRes] = await Promise.all([
                            fetch('/api/status'),
                            fetch('/api/preferences'),
                            fetch('/api/collectors'),
                            fetch('/api/backups'),
                            fetch('/api/corpus/stats'),
                            fetch('/api/corpus/tree')
                        ]);

                        this.services = await statusRes.json();
                        this.preferences = await prefsRes.json();
                        this.collectors = await collectorsRes.json();
                        const backupsData = await backupsRes.json();
                        this.backups = backupsData.backups || [];
                        this.corpusStats = await corpusStatsRes.json();
                        this.corpusTree = await corpusTreeRes.json();

                        if (!this.claudeMdChanged) {
                            await this.loadClaudeMd();
                        }

                        this.lastUpdate = new Date().toLocaleTimeString();
                        this.updateCharts();
                    } catch (e) {
                        console.error('Load failed:', e);
                    }
                },

                initCharts() {
                    // Approval Chart
                    const ctx1 = document.getElementById('approvalChart');
                    if (ctx1) {
                        this.approvalChart = new Chart(ctx1, {
                            type: 'bar',
                            data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: {
                                    y: { beginAtZero: true, max: 100, grid: { color: '#333' }, ticks: { color: '#888' } },
                                    x: { grid: { display: false }, ticks: { color: '#888' } }
                                }
                            }
                        });
                    }

                    // Signals Chart
                    const ctx2 = document.getElementById('signalsChart');
                    if (ctx2) {
                        this.signalsChart = new Chart(ctx2, {
                            type: 'doughnut',
                            data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { position: 'right', labels: { color: '#ccc' } } }
                            }
                        });
                    }
                },

                updateCharts() {
                    const prefs = this.preferences.current_preferences || {};
                    const labels = Object.keys(prefs).map(k => k.replace('_', ' '));
                    const rates = Object.values(prefs).map(d => Math.round((d.approval_rate || 0) * 100));
                    const signals = Object.values(prefs).map(d => d.total_signals || 0);
                    const colors = ['#05d9e8', '#9d4edd', '#ff2a6d', '#f9c80e', '#00ff88', '#ff6b35'];

                    if (this.approvalChart) {
                        this.approvalChart.data.labels = labels;
                        this.approvalChart.data.datasets[0].data = rates;
                        this.approvalChart.data.datasets[0].backgroundColor = colors.slice(0, labels.length);
                        this.approvalChart.update();
                    }

                    if (this.signalsChart) {
                        this.signalsChart.data.labels = labels;
                        this.signalsChart.data.datasets[0].data = signals;
                        this.signalsChart.data.datasets[0].backgroundColor = colors.slice(0, labels.length);
                        this.signalsChart.update();
                    }
                },

                // Helpers
                getTotalSignals() {
                    const prefs = this.preferences.current_preferences || {};
                    return Object.values(prefs).reduce((sum, d) => sum + (d.total_signals || 0), 0);
                },

                getAvgApproval() {
                    const prefs = this.preferences.current_preferences || {};
                    const values = Object.values(prefs);
                    if (values.length === 0) return 0;
                    const avg = values.reduce((sum, d) => sum + (d.approval_rate || 0), 0) / values.length;
                    return Math.round(avg * 100);
                },

                formatBytes(bytes) {
                    if (bytes < 1024) return bytes + ' B';
                    return (bytes / 1024).toFixed(1) + ' KB';
                },

                // API Methods
                async loadClaudeMd() {
                    try {
                        const res = await fetch('/api/claude-md');
                        const data = await res.json();
                        this.claudeMd = data.content || '';
                        this.claudeMdExists = data.exists;
                        this.claudeMdChanged = false;
                    } catch (e) { console.error('Load CLAUDE.md failed:', e); }
                },

                async saveClaudeMd() {
                    try {
                        await fetch('/api/claude-md', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content: this.claudeMd })
                        });
                        this.claudeMdChanged = false;
                        await this.loadAllData();
                        alert('Saved!');
                    } catch (e) { alert('Error: ' + e.message); }
                },

                async triggerReflection() {
                    this.reflecting = true;
                    try {
                        const res = await fetch('/api/reflect', { method: 'POST' });
                        const data = await res.json();
                        await this.loadAllData();
                        alert(`Reflex√£o completa!\n\nSinais: ${data.signals_count}\nInsights: ${data.insights_count}\nAtualizado: ${data.updated}`);
                    } catch (e) { alert('Error: ' + e.message); }
                    this.reflecting = false;
                },

                async startCollector(name) {
                    try {
                        await fetch(`/api/collectors/${name}/start`, { method: 'POST' });
                        await new Promise(r => setTimeout(r, 1000));
                        await this.loadAllData();
                    } catch (e) { alert('Error: ' + e.message); }
                },

                async stopCollector(name) {
                    try {
                        await fetch(`/api/collectors/${name}/stop`, { method: 'POST' });
                        await this.loadAllData();
                    } catch (e) { alert('Error: ' + e.message); }
                },

                async restoreBackup(path) {
                    if (!confirm('Restaurar este backup?')) return;
                    try {
                        await fetch('/api/backups/restore', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ path })
                        });
                        await this.loadClaudeMd();
                        await this.loadAllData();
                        alert('Backup restaurado!');
                    } catch (e) { alert('Error: ' + e.message); }
                },

                async searchCorpus() {
                    if (!this.corpusSearch) { this.corpusResults = []; return; }
                    try {
                        const res = await fetch(`/api/corpus/search?q=${encodeURIComponent(this.corpusSearch)}`);
                        const data = await res.json();
                        this.corpusResults = data.results || [];
                    } catch (e) { console.error('Search failed:', e); }
                },

                async loadFullText(textId) {
                    try {
                        const res = await fetch(`/api/corpus/text/${textId}`);
                        this.fullText = await res.json();
                    } catch (e) { console.error('Load text failed:', e); }
                }
            };
        }
    </script>
</body>
</html>
